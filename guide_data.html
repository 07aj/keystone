---
permalink: /guide/data/
---
<!DOCTYPE html><html><head><script>var _sf_startpt=(new Date()).getTime()</script><meta charset="utf-8"><meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width"><title>KeystoneJS &middot; Setting up and using Data Models</title><link href="/styles/site.min.css" rel="stylesheet"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"></head><body><header role="banner" id="docs-header"><div class="container"><a href="/" title="KeystoneJS" class="keystone-logo"><img src="/images/logo.svg" alt="KeystoneJS" width="207" height="70"></a><div class="social-buttons hidden-xs"><a href="https://twitter.com/keystonejs" data-show-count="false" class="twitter-follow-button">Follow @keystonejs</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><iframe src="http://ghbtns.com/github-btn.html?user=JedWatson&amp;repo=keystone&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe></div></div></header><nav id="docs-nav"><div class="container"><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href="/guide">Getting Started</a></li><li class="active"><a href="/guide/data">Database</a></li><li><a href="/examples">Examples</a></li></ul></div></nav><div id="docs-body"><div class="container"><div class="alerts"><div class="alert alert-success">The KeystoneJS docs are in beta. For updates, please follow @keystonejs on twitter!</div></div></div><div class="container"><div class="row"><div class="col-sm-3"><div id="docs-sidebar"><ul class="sidebar-nav"><li class="nav-label">Database</li><li><a href="#concepts">Concepts</a></li><li class="nav-label">Lists</li><li><a href="#lists_usage">Usage</a></li><li><a href="#lists_example">Example</a></li><li><a href="#lists_options">List Options</a></li><li><a href="#lists_querying">Querying Data</a></li><li class="nav-label">Fields</li><li><a href="#fields_overview">Overview</a></li><li><a href="#fields_options">Field Options</a></li><li><a href="#fields_underscoremethods">Underscore Methods</a></li><li class="nav-label">Field Types</li><li><a href="#field_boolean">Boolean</a></li><li><a href="#field_text">Text</a></li><li><a href="#field_textarea">Textarea</a></li><li><a href="#field_email">Email</a></li><li><a href="#field_url">Url</a></li><li><a href="#field_html">Html</a></li><li><a href="#field_date">Date</a></li><li><a href="#field_datetime">Datetime</a></li><li><a href="#field_key">Key</a></li><li><a href="#field_number">Number</a></li><li><a href="#field_money">Money</a></li><li><a href="#field_select">Select</a></li><li><a href="#field_markdown">Markdown</a></li><li><a href="#field_name">Name</a></li><li><a href="#field_password">Password</a></li><li><a href="#field_location">Location</a></li><li><a href="#field_cloudinaryimage">CloudinaryImage</a></li><li><a href="#field_cloudinaryimages">CloudinaryImages</a></li><li><a href="#field_embedly">Embedly</a></li></ul></div></div><div class="col-sm-9"><div id="docs-content"><a name="concepts"></a><h1>Setting up &amp; Using Data Models</h1><p>In KeystoneJS, your data schema and models are controlled by <strong>Lists</strong>, and documents in your database are often called <strong>Items</strong>.</p><p>To define a data model, you create a <code>new keystone.List</code>, and pass it <a href="#lists_options">list options</a>. </p><p>You then <code>add</code> fields to the list. Behind the scenes, a Keystone List will create a <a href="http://mongoosejs.com/docs/guide.html" target="_blank">mongoose schema</a>, and add the appropriate paths to it for the fields you define.</p><p>The <code>schema</code> is accessible, allowing you to plug in other mongoose functionality like virtuals, methods and pre / post save hooks.</p><p>When you have finished setting up your List, call <code>list.register()</code> to initialise it and register it with Keystone.</p><p>To query your data, you use the <code>list.model</code> (which is a <a href="http://mongoosejs.com/docs/models.html" target="_blank">mongoose model</a>).</p><p>List Items are <a href="http://mongoosejs.com/docs/documents.html" target"_blank">mongoose documents</a>. To create new items, use <code>new list.model()</code> and when you're ready to save it (or to save changes to an existing Item), call <code>item.save()</code>.</p><a name="lists_usage"></a><h2>Lists</h2><h3>Usage</h3><p>The syntax for creating a <strong>Keystone List</strong> is very similar to the syntax for creating a Mongoose Schema, with the exception of the constructor, which is <code>var MyList = new keystone.List(key, options)</code>.</p><p>Once you have created a new List, add fields to it using <code>MyList.add(fields)</code>, where fields is an object of keys (for field paths) and values (for field types, or options).</p><p>Fields are defined by an object with a <code>type</code> property, which must be a valid Field Type or basic data type. Using the object syntax you can specify additional options for the field. Common field options and field-type-specific options are detailed in the fields documentation.</p><p>When all the fields and options have been set on the list, call <code>MyList.register()</code> to register the list with Keystone and finalise its configuration.</p><a name="lists_example"></a><p><strong>For example: </strong> a simple Post model for a blog might look like this:</p><div class="code-header"><h4>Post.js</h4></div><pre>var keystone = require('keystone'),
    Types = keystone.Field.Types;
var Post = new keystone.List('Post', {
    autokey: { path: 'slug', from: 'title', unique: true },
    map: { name: 'title' },
    defaultSort: '-createdAt'
});
Post.add({
    title: { type: String, required: true },
    slug: { type: String, index: true },
    state: { type: Types.Select, options: 'draft, published, archived', default: 'draft' },
    author: { type: Types.Relationship, ref: 'User' },
    createdAt: { type: Date, default: Date.now },
    publishedAt: Date,
    image: { type: Types.CloudinaryImage },
    content: {
        brief: { type: Types.Html, wysiwyg: true, height: 150 },
        extended: { type: Types.Html, wysiwyg: true, height: 400 }
    }
});
Post.defaultColumns = 'title, state|20%, author, pubilshedAt|15%'
Post.register();</pre><p class="note">This example implements the optional <code>map</code>, <code>autokey</code> and <code>defaultSort</code> options, described below.</p><p class="note">It also specifies <code>title</code>, <code>state</code>, <code>author</code> and <code>publishedAt</code> as the default columns to display in the Admin UI, with state and publishedAt being given column widths.</p><p class="note">The <code>author</code> field is a relationship with the <code>User</code> model, as described in the <a href="/guide#models_users">getting started guide</a>.</p><a name="lists_options"></a><h3>Options</h3><p>Lists support the following options:</p><table class="table"><col width="200"><col><tr><td><code>drilldown</code> <code class="data-type">String</code></td><td>A space-delimited list of relationships to display as drilldown in the Admin UI</td></tr><tr><td><code>sortable</code> <code class="data-type">Boolean</code></td><td>Adds a hidden field <code>sortOrder</code> to the schema, and enables drag and drop sorting in the Admin UI</td></tr><tr><td><code>sortContext</code> <code class="data-type">String</code></td><td>A <code>List:relationship</code> pair to control when drag and drop sorting is available in the Admin UI</td></tr><tr><td><code>searchFields</code> <code class="data-type">String</code></td><td>A space-delimited list of paths to use for searching in Admin UI</td></tr><tr><td><code>defaultSort</code> <code class="data-type">String</code></td><td>The default column or path to sort on in the Admin UI</td></tr><tr><td><code>defaultColumns</code> <code class="data-type">String</code></td><td>A comma-delimited list of default columns to display in the Admin UI List View.
 You can specify width in either pixels or percent after a <code>|</code> pipe character.</td></tr><tr><td><code>map</code> <code class="data-type">Object</code></td><td>An object that maps fields to special <strong>list</strong> paths. Each path defaults to its key if a field with that key is added. Mappable paths include<ul class="options"><li><code>name</code> - the field that contains the name of the item, for display in the Admin UI</li></ul></td></tr><tr><td><code>autokey</code> <code class="data-type">Object</code></td><td>Adds a plugin to the list that automatically generates a key for each document when it is saved, based on the value of another field or path. The value of the option should be an object with the following keys:<ul class="options"><li><code>from</code> <code class="data-type">String</code> - the field or path to generate the key from, can be a space-delimited list of fields</li><li><code>path</code> <code class="data-type">String</code> - the path to store the key at</li><li><code>unique</code> <code class="data-type">Boolean</code> - whether the key should be unique or not</li></ul><em>Autokey paths are automatically be indexed; you may also want to include them in compound indexes.</em></td></tr><tr><td><code>noedit</code> <code class="data-type">Boolean</code></td><td>Prevents editing of items in the list through the Keystone Admin UI</td></tr><tr><td><code>nocreate</code> <code class="data-type">Boolean</code></td><td>Prevents creation of new items in the list through the Keystone Admin UI</td></tr><tr><td><code>nodelete</code> <code class="data-type">Boolean</code></td><td>Prevents deletion of items from the list through the Keystone Admin UI</td></tr></table><a name="lists_querying"></a><h3>Querying Data</h3><p>To query data, you can use any of the <a href="http://mongoosejs.com/docs/queries.html" target="_blank">mongoose query</a> methods on the <code>list.model</code>.</p><p><strong>For example:</strong> to load the last 5 <code>posts</code> with the state <code>published</code>, populating the linked <code>author</code>, sorted by reverse published date:</p><div class="code-header"><h4>Loading Posts</h4></div><pre>var keystone = require('keystone'),
    Post = keystone.list('Post');
 
Post.model.find()
    .where('state', 'published')
    .populate('author')
    .sort('-publishedAt')
    .limit(5)
    .exec(function(err, posts) {
        // do something with posts
    });</pre><h3>Creating, updating and Removing Items</h3><p>To create new items, again use the <a href="http://mongoosejs.com/docs/models.html" target"_blank">mongoose model</a>:</p><div class="code-header"><h4>Creating Posts</h4></div><pre>var keystone = require('keystone'),
    Post = keystone.list('Post');
 
var newPost = new Post.model({
    title: 'New Post'
});
 
if (shouldBePublished) {
    newPost.state = 'published';
}
 
newPost.save(function(err) {
    // post has been saved	
});</pre><p>To delete items, first load the data, then use the <code>remove</code> method:</p><div class="code-header"><h4>Deleting a Posts</h4></div><pre>var keystone = require('keystone'),
    Post = keystone.list('Post');
 
Post.model.findById(postId)
    .remove(function(err) {
        // post has been deleted
    });</pre><!-- TODO: Documentation for Schema features (virtuals, methods, statics and hooks)--><!-- TODO: Documentation for Update Handler--><a name="fields_overview"></a><h2>Fields</h2><p>When adding <strong>fields</strong> to <strong>Lists</strong>, you can either specify basic data types or Keystine Field Types.</p><p><strong>Keystone Fields</strong> allow you to easily add rich, functional fields to your application's models. They are designed to describe not just the <em>structure</em> of your data, but also the <em>intention</em> of your data. They provide:</p><ul><li>Rich controls in Keystone's Admin UI</li><li>Complex data types; e.g. the <code>location</code> field stores several strings and an GeoJSON lng/lat point</li><li>Formatting and validation methods</li><li>Additional virtual properties; e.g. the <code>name</code> field provides a <code>name.full</code> virtual which concatenates the stored <code>name.first</code> and <code>name.last</code></li><li>Underscore methods; e.g. the <code>password</code> field provides a <code>password.compare</code> method for testing against the encrypted hash</li><li>Metadata about how fields relate to each other; e.g. which fields depend on certain values in other fields</li></ul><p>Basic data types are mapped to their corresponding Keystone field types:</p><table style="width:200px" class="table"><col><col><thead><th>Data type</th><th>Field type</th></thead><tr><td><code class="data-type">String</code></td><td><code class="data-type">Text</code></td></tr><tr><td><code class="data-type">Number</code></td><td><code class="data-type">Number</code></td></tr><tr><td><code class="data-type">Date</code></td><td><code class="data-type">DateTime</code></td></tr><tr><td><code class="data-type">Boolean</code></td><td><code class="data-type">Boolean</code></td></tr></table><a name="fields_options"></a><h3>Field Options</h3><p>All field types support several common options, which can specify database settings (such as <code>index</code> and <code>default</code>), or can provide information for Keystone's Admin UI (such as <code>label</code>).</p><p class="note">Fields can be nested inside objects, as in mongoose schemas.</p><p class="note">All <a href="http://mongoosejs.com/docs/schematypes.html" target="_blank">mongoose schema type options</a> are passed to the <a href="http://mongoosejs.com/docs/guide.html" target="_blank">mongoose schema</a>, so you can also use any options mongoose supports.</p><p>Common field options include:</p><table class="table"><col width="200"><col><tr><td><code>label</code> <code class="data-type">String</code></td><td>The label of each field is generated from the field path; set this option to override the default.</td></tr><tr><td><code>required</code> <code class="data-type">Boolean</code></td><td>Validates that the field has a value before an item can be saved (<em>also passed to mongoose and enforced using a database index</em>).</td></tr><tr><td><code>initial</code> <code class="data-type">Boolean</code></td><td>Causes the field to be displayed in the <strong>Create Item</strong> form, in the Admin UI.</td></tr><tr><td><code>noedit</code> <code class="data-type">Boolean</code></td><td>Renders the field as read-only in the admin UI.</td></tr><tr><td><code>note</code> <code class="data-type">String</code></td><td>Is displayed with the field in the admin UI.</td></tr><tr><td><code>collapse</code> <code class="data-type">Boolean</code></td><td>Displays an <strong>+ <u>add</u></strong> link in the admin UI when the field has no value. Will completely hide field UI when <code>noedit</code> is also set to true, when the field has no value.</td></tr><tr><td><code>dependsOn</code> <code class="data-type">Object</code></td><td>Hides the field in the admin UI unless the specified conditions (other field values) are met.</td></tr></table><!-- TODO: Documentation for field methods--><a name="fields_underscoremethods"></a><h3>Underscore Methods</h3><p>Some field types include helpful <strong>underscore methods</strong>, which are available on the item at the field's path preceeded by an underscore.</p><p><strong>For example</strong>: use the <code>format</code> underscore method of the <code>createdAt</code> <code class="data-type">DateTime</code> field of the Posts List (above) like this</p><pre>var keystone = require('keystone'),
    Post = keystone.list('Post');
 
Post.model.findById(postId).exec(function(err, post) {
   console.log(post._.createdAt.format('Do MMMM YYYY')); // 25th August 2013
});</pre><a name="field_types"></a><h2>Field Types</h2><a name="field_boolean"></a><h4><code>Boolean</code> <code class="data-type">Boolean</code> &mdash; Displayed as a checkbox in the Admin UI</h4><pre>{ type: Types.Boolean }</pre><a name="field_text"></a><h4><code>Text</code> <code class="data-type">String</code> &mdash; Displayed as a text field in the Admin UI</h4><pre>{ type: Types.Text }</pre><a name="field_textarea"></a><h4><code>Textarea</code> <code class="data-type">String</code> &mdash; Displayed as a textarea field in the Admin UI</h4><pre>{ type: Types.Textarea }</pre><div class="options"><h5>Options</h5><p><code>height</code> <code class="data-type">Number</code> - the height of the field (in pixels)</p></div><a name="field_email"></a><h4><code>Email</code> <code class="data-type">String</code> &mdash; Displayed as a text field in the Admin UI</h4><p class="note">Input must look like a valid email address (can be blank unless field is required)</p><pre>{ type: Types.Email }</pre><a name="field_url"></a><h4><code>Url</code> <code class="data-type">String</code> &mdash; Displayed as a text field in the Admin UI.</h4><pre>{ type: Types.Text }</pre><div class="options"><h5>Underscore methods:</h5><p><code>format()</code> - formats the stored value by stripping the leading protocol (if any)</p><pre>item.url = "http://keystonejs.com";
item._.url.format(); // "keystonejs.com"</pre></div><a name="field_html"></a><h4><code>Html</code> <code class="data-type">String</code> &mdash; Displayed as a text field or WYSIWYG Editor in the Admin UI.</h4><pre>{ type: Types.Html, wysiwyg: true }</pre><div class="options"><h5>Options</h5><p><code>wysiwyg</code> <code class="data-type">Boolean</code> - whether to display a WYSIWYG editor in the Admin UI</p><p><code>height</code> <code class="data-type">Number</code> - the height of the field (in pixels)</p></div><a name="field_date"></a><h4><code>Date</code> <code class="data-type">Date</code> &mdash; Displayed as a date picker in the Admin UI</h4><pre>{ type: Types.Date }</pre><p class="note">Input should either be a valid <strong>Date</strong>, or a string in the format <strong>YYYY-MM-DD</strong> (can be blank unless field is required)</p><p class="note">To default Date fields to the current time, set the <code>default</code> option to <code>Date.now</code></p><div class="options"><h5>Underscore methods:</h5><p><code>format(string)</code> - formats the stored value using <a href="http://momentjs.com" target="_blank">momentjs</a>.</p><p>Format string defaults to <strong>Do MMM YYYY</strong></p></div><a name="field_datetime"></a><h4><code>Datetime</code> <code class="data-type">Date</code> &mdash; Displayed as a date and time picker in the Admin UI</h4><pre>{ type: Types.Date }</pre><p class="note">Input should either be a valid <strong>Date</strong>, or a string in the format <strong>YYYY-MM-DD</strong> (can be blank unless field is required)</p><p class="note">To default Date fields to the current time, set the <code>default</code> option to <code>Date.now</code></p><div class="options"><h5>Underscore methods:</h5><p><code>format(string)</code> - formats the stored value using <a href="http://momentjs.com" target="_blank">momentjs</a>.</p><p>Format string defaults to <strong>Do MMM YYYY hh:mm:ss a</strong></p></div><a name="field_key"></a><h4><code>Key</code> <code class="data-type">String</code> &mdash; Displayed as a text field in the Admin UI</h4><pre>{ type: Types.Key }</pre><p>Automatically converts input to a valid key (no spaces or special characters). White space is replaced with a separator.</p><div class="options"><h5>Options</h5><p><code>separator</code> <code class="data-type">String</code> - the separator to use when replace white space in the input; defaults to <strong>-</strong></p></div><a name="field_number"></a><h4><code>Number</code> <code class="data-type">Number</code> &mdash; Displayed as a number field in the Admin UI</h4><pre>{ type: Types.Number }</pre><p class="note">Input should either be a valid <strong>Number</strong>, or a string that can be converted to a number (can be blank unless field is required)</p><div class="options"><h5>Underscore methods:</h5><p><code>format(string)</code> - formats the stored value using <a href="http://numeraljs.com" target="_blank">numeraljs</a>.</p><p>Format string defaults to <strong>0,0[.][000000000000]</strong></p></div><a name="field_money"></a><h4><code>Money</code> <code class="data-type">Number</code> &mdash; Displayed as a number field in the Admin UI</h4><pre>{ type: Types.Money }</pre><p class="note">Input should either be a valid <strong>Number</strong>, or a string that can be converted to a number (leading symbols are allowed; can be blank unless field is required). Money fields do not understand currency.</p><div class="options"><h5>Underscore methods:</h5><p><code>format(string)</code> - formats the stored value using <a href="http://numeraljs.com" target="_blank">numeraljs</a>.</p><p>Format string defaults to <strong>$0,0.00</strong></p></div><a name="field_select"></a><h4><code>Select</code> <code class="data-type">String</code> or <code class="data-type">Number</code> &mdash; Displayed as a select field in the Admin UI</h4><pre>{ type: Types.Select }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_markdown"></a><h4><code>Markdown</code> <code class="data-type">String</code> &mdash; Displayed as a textarea field in the Admin UI</h4><pre>{ type: Types.Markdown }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_name"></a><h4><code>Name</code> <code class="data-type">Object</code> &mdash; Displayed as <strong>firstname</strong> <strong>lastname</strong> fields in the Admin UI</h4><pre>{ type: Types.Name }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_password"></a><h4><code>Password</code> <code class="data-type">String</code> &mdash; Displayed as a password field in the Admin UI</h4><pre>{ type: Types.Password }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_location"></a><h4><code>Location</code> <code class="data-type">Object</code> &mdash; Displayed as a combination of fields in the Admin UI</h4><pre>{ type: Types.Location }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_cloudinaryimage"></a><h4><code>CloudinaryImage</code> <code class="data-type">Object</code> &mdash; Displayed as an image upload field in the Admin UI</h4><pre>{ type: Types.CloudinaryImage }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_cloudinaryimages"></a><h4><code>CloudinaryImages</code> <code class="data-type">Object</code> &mdash; Displayed as an image upload field in the Admin UI</h4><pre>{ type: Types.CloudinaryImages }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><a name="field_embedly"></a><h4><code>Embedly</code> <code class="data-type">Object</code> &mdash; Displayed as read-only data in the Admin UI</h4><pre>{ type: Types.Embedly, from: 'path' }</pre><p class="note">Documentation coming soon (see <a href="https://github.com/JedWatson/keystone/#field-types" target="_blank">readme</a> for current docs)</p><!-- TODO: Documentation for Relationships--></div></div></div></div></div><div id="docs-footer"><div class="container"><div class="social-buttons"><div class="social-button"><a href="https://twitter.com/keystonejs" data-show-count="false" class="twitter-follow-button">Follow @keystonejs</a></div><div class="social-button"><iframe src="http://ghbtns.com/github-btn.html?user=JedWatson&amp;repo=keystone&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe></div></div><div class="footer-wrap">	<ul class="list-links"><li><a href="https://github.com/JedWatson/keystone" target="_blank" title="Github Project">Github Project</a></li><li><a href="http://demo.keystonejs.com" target="_blank" title="Demo Website">Demo Website</a></li></ul><p class="copyright">&copy; 2013 Jed Watson</p></div></div></div><script src="/js/lib/jquery/jquery-1.10.2.min.js"></script><script src="/js/lib/bootstrap/collapse.js"></script><script src="/js/lib/bootstrap/dropdown.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43970386-1', 'keystonejs.com');
ga('send', 'pageview');</script><script>var _sf_async_config = { uid: 46610, domain: 'keystonejs.com', useCanonical: true };
(function() {
 function loadChartbeat() {
  window._sf_endpt = (new Date()).getTime();
  var e = document.createElement('script');
  e.setAttribute('language', 'javascript');
  e.setAttribute('type', 'text/javascript');
  e.setAttribute('src','//static.chartbeat.com/js/chartbeat.js');
  document.body.appendChild(e);
 };
 var oldonload = window.onload;
 window.onload = (typeof window.onload != 'function') ?
 loadChartbeat : function() { oldonload(); loadChartbeat(); };
})();
</script></body></html>